tinymce.PluginManager.add("importcss",function(t){function e(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t}function n(e){var n,i=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(e);if(i){var r=i[1],s=i[2].substr(1).split(".").join(" "),c=tinymce.makeMap("a,img");return i[1]?(n={title:e},t.schema.getTextBlockElements()[r]?n.block=r:t.schema.getBlockElements()[r]||c[r.toLowerCase()]?n.selector=r:n.inline=r):i[2]&&(n={inline:"span",title:e.substr(1),classes:s}),!1!==t.settings.importcss_merge_classes?n.classes=s:n.attributes={class:s},n}}var i=this,r=tinymce.each;t.on("renderFormatsMenu",function(s){var c=t.settings,o={},a=c.importcss_selector_converter||n,l=e(c.importcss_selector_filter),f=s.control;t.settings.importcss_append||f.items().remove();var m=[];tinymce.each(c.importcss_groups,function(t){(t=tinymce.extend({},t)).filter=e(t.filter),m.push(t)}),r(function(e,n){function i(t,e){var c,o=t.href;if(o&&n(o,e)){r(t.imports,function(t){i(t,!0)});try{c=t.cssRules||t.rules}catch(t){}r(c,function(t){t.styleSheet?i(t.styleSheet,!0):t.selectorText&&r(t.selectorText.split(","),function(t){s.push(tinymce.trim(t))})})}}var s=[],c={};r(t.contentCSS,function(t){c[t]=!0}),n||(n=function(t,e){return e||c[t]});try{r(e.styleSheets,function(t){i(t)})}catch(t){}return s}(s.doc||t.getDoc(),e(c.importcss_file_filter)),function(e){if(-1===e.indexOf(".mce-")&&!o[e]&&(!l||l(e))){var n,r=a.call(i,e);if(r){var s=r.name||tinymce.DOM.uniqueId();if(m)for(var c=0;c<m.length;c++)if(!m[c].filter||m[c].filter(e)){m[c].item||(m[c].item={text:m[c].title,menu:[]}),n=m[c].item.menu;break}t.formatter.register(s,r);var u=tinymce.extend({},f.settings.itemDefaults,{text:r.title,format:s});n?n.push(u):f.add(u)}o[e]=!0}}),r(m,function(t){f.add(t.item)}),s.control.renderNew()}),i.convertSelectorToFormat=n});