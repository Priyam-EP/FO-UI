tinymce.PluginManager.add("noneditable",function(e){function t(e){var t;if(1===e.nodeType){if((t=e.getAttribute(s))&&"inherit"!==t)return t;if("inherit"!==(t=e.contentEditable))return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(t){var n=o.length,r=t.content,a=tinymce.trim(i);if("raw"!=t.format){for(;n--;)r=r.replace(o[n],function(t){var n=arguments,i=n[n.length-2];return i>0&&'"'==r.charAt(i-1)?t:'<span class="'+a+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var a,i,o,l=tinymce.dom.TreeWalker,f="contenteditable",s="data-mce-"+f,c=tinymce.util.VK;a=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",i=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",(o=e.getParam("noneditable_regexp"))&&!o.length&&(o=[o]),e.on("PreInit",function(){(function(){function r(e){for(;e;){if(e.id===u)return e;e=e.parentNode}}function a(e){var t;if(e)for(t=new l(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function i(n,r){var a,i;return"false"===t(n)&&s.isBlock(n)?void d.select(n):(i=s.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode("Â ")),n=n.firstChild,r=!0),a=s.create("span",{id:u,"data-mce-bogus":!0},m),r?n.parentNode.insertBefore(a,n):s.insertAfter(a,n),i.setStart(a.firstChild,1),i.collapse(!0),d.setRng(i),a)}function o(e){var t,n,r;if(e)(t=d.getRng(!0)).setStartBefore(e),t.setEndBefore(e),(n=a(e))&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),s.remove(e,!0),d.setRng(t);else for(;(e=s.get(u))&&e!==r;)(n=a(e))&&n.nodeValue.charAt(0)==m&&(n=n.deleteData(0,1)),s.remove(e,!0),r=e}function f(){function e(e,n){var r,a,i,o,f;if(r=s.startContainer,a=s.startOffset,3==r.nodeType){if(f=r.nodeValue.length,a>0&&f>a||(n?a==f:0===a))return}else{if(!(a<r.childNodes.length))return n?null:e;var c=!n&&a>0?a-1:a;(r=r.childNodes[c]).hasChildNodes()&&(r=r.firstChild)}for(i=new l(r,e);o=i[n?"prev":"next"]();){if(3===o.nodeType&&o.nodeValue.length>0)return;if("true"===t(o))return o}return e}var r,a,f,s,c;o(),f=d.isCollapsed(),r=n(d.getStart()),a=n(d.getEnd()),(r||a)&&(s=d.getRng(!0),f?(r=r||a,(c=e(r,!0))?i(c,!0):(c=e(r,!1))?i(c,!1):d.select(r)):(s=d.getRng(!0),r&&s.setStartBefore(r),a&&s.setEndAfter(a),d.setRng(s)))}var s=e.dom,d=e.selection,u="mce_noneditablecaret",m="\ufeff";e.on("mousedown",function(n){var r=e.selection.getNode();r&&-1!==r.className.indexOf("mceTmpParagraph")&&r!==n.target&&("&nbsp;"===r.innerHTML||""===r.innerHTML||" "===r.innerHTML?s.remove(r):r.className=r.className.replace("mceTmpParagraph","")),"false"===t(r)&&r==n.target&&f()}),e.on("mouseup",f),e.on("keydown",function(a){function i(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function u(e,t){d.select(e),d.collapse(t)}var m,p,g,v,E=a.keyCode;f(),g=d.getStart(),v=d.getEnd(),m=n(g)||n(v);var T=e.selection.getNode(),h=E==c.LEFT||E==c.RIGHT||E==c.UP||E==c.DOWN,b=E==c.LEFT||E==c.UP;if(m&&(112>E||E>124)&&E!=c.DELETE&&E!=c.BACKSPACE){if((tinymce.isMac?a.metaKey:a.ctrlKey)&&(67==E||88==E||86==E))return;if(a.preventDefault(),h)if(e.dom.isBlock(m)){var C=b?m.previousSibling:m.nextSibling;if(!C||C&&"false"===t(C)){var y=s.create("p",null,"&nbsp;");y.className="mceTmpParagraph";var N=b?m:C;N&&N.parentNode?N.parentNode.insertBefore(y,N):C||b||m.parentNode.appendChild(y),C=y}var S=new l(C,C);u(b?S.prev():S.next(),!b)}else u(m,b)}else if(h||E==c.BACKSPACE||E==c.DELETE){if(p=r(g)){if(E==c.LEFT||E==c.BACKSPACE)if((m=i(p,!0))&&"false"===t(m)){if(a.preventDefault(),E!=c.LEFT)return void s.remove(m);u(m,!0)}else o(p);if(E==c.RIGHT||E==c.DELETE)if((m=i(p,!0))&&"false"===t(m)){if(a.preventDefault(),E!=c.RIGHT)return void s.remove(m);u(m,!1)}else o(p)}else{if(h&&T&&-1!==T.className.indexOf("mceTmpParagraph")&&T[b?"previousSibling":"nextSibling"]){var A=T[b?"previousSibling":"nextSibling"];"&nbsp;"===T.innerHTML||""===T.innerHTML||" "===T.innerHTML?s.remove(T):T.className=T.className.replace("mceTmpParagraph",""),u(A,!b)}var B=d.getRng(!0),P=B.endContainer;if(s.isBlock(P)&&s.isBlock(P.nextSibling)&&1==B.endOffset&&E==c.DELETE&&(m=n(P.nextSibling)),m&&(E==c.DELETE||E==c.BACKSPACE)&&s.isBlock(m))return a.preventDefault(),void s.remove(m)}if((E==c.BACKSPACE||E==c.DELETE)&&!function(a){function i(e){for(var t=l;t;){if(t===e)return;t=t.parentNode}s.remove(e),f()}var o,l,c,u;if(d.isCollapsed()){if(o=d.getRng(!0),l=o.startContainer,c=o.startOffset,l=r(l)||l,u=n(l))return i(u),!1;if(3==l.nodeType&&(a?c>0:c<l.nodeValue.length))return!0;if(1==l.nodeType&&(l=l.childNodes[c]||l),function(){var r,o,f=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(l,e.getBody());(r=a?o.prev():o.next())&&!f[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return i(r),!0;return!!n(r)}())return!1}return!0}(E==c.BACKSPACE))return a.preventDefault(),!1}})})(),o&&e.on("BeforeSetContent",r),e.parser.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)n=e[r],-1!==(t=" "+n.attr("class")+" ").indexOf(a)?n.attr(s,"true"):-1!==t.indexOf(i)&&n.attr(s,"false")}),e.serializer.addAttributeFilter(s,function(e){for(var t,n=e.length;n--;)t=e[n],o&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(f,null),t.attr(s,null))}),e.parser.addAttributeFilter(f,function(e){for(var t,n=e.length;n--;)(t=e[n]).attr(s,t.attr(f)),t.attr(f,null)})}),e.on("drop",function(e){n(e.target)&&e.preventDefault()})});