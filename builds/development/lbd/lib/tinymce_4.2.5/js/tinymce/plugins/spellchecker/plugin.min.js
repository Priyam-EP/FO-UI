!function(e,t){"use strict";function n(e,t){for(var n,r=[],c=0;c<e.length;++c){if(!(n=i[e[c]]||o(e[c])))throw"module definition dependecy not found: "+e[c];r.push(n)}t.apply(null,r)}function r(e,r,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(o===t)throw"invalid module definition, definition function must be specified";n(r,function(){i[e]=o.apply(null,arguments)})}function o(t){for(var n=e,r=t.split(/[.\/]/),o=0;o<r.length;++o){if(!n[r[o]])return;n=n[r[o]]}return n}var i={};r("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(e,t){function n(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}}function r(e){var t;if(3===e.nodeType)return e.data;if(p[e.nodeName]&&!h[e.nodeName])return"";if(t="",(h[e.nodeName]||g[e.nodeName])&&(t+="\n"),e=e.firstChild)do{t+=r(e)}while(e=e.nextSibling);return t}function o(e){e.parentNode.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function i(t){var n=e.getElementsByTagName("*"),r=[];t="number"==typeof t?""+t:null;for(var o=0;o<n.length;o++){var i=n[o],c=i.getAttribute("data-mce-index");null!==c&&c.length&&(c===t||null===t)&&r.push(i)}return r}function c(e){for(var t=m.length;t--;)if(m[t]===e)return t;return-1}function a(e){for(var t=0,n=m.length;n>t&&!1!==e(m[t],t);t++);return this}function l(t){return m.length&&function(e,t,n){var r,o,i,c,a,l=[],s=0,d=e,u=0;(t=t.slice(0)).sort(function(e,t){return e.start-t.start}),a=t.shift();e:for(;;){if((h[d.nodeName]||g[d.nodeName])&&s++,3===d.nodeType&&(!o&&d.length+s>=a.end?(o=d,c=a.end-s):r&&l.push(d),!r&&d.length+s>a.start&&(r=d,i=a.start-s),s+=d.length),r&&o){if(d=n({startNode:r,startNodeIndex:i,endNode:o,endNodeIndex:c,innerNodes:l,match:a.text,matchIndex:u}),s-=o.length-c,r=null,o=null,l=[],a=t.shift(),u++,!a)break}else{if((!p[d.nodeName]||h[d.nodeName])&&d.firstChild){d=d.firstChild;continue}if(d.nextSibling){d=d.nextSibling;continue}}for(;;){if(d.nextSibling){d=d.nextSibling;break}if(d.parentNode===e)break e;d=d.parentNode}}}(e,m,function(e){function t(t,n){var r=m[n];r.stencil||(r.stencil=e(r));var o=r.stencil.cloneNode(!1);return o.setAttribute("data-mce-index",n),t&&o.appendChild(v.doc.createTextNode(t)),o}return function(e){var n,r,o,i=e.startNode,c=e.endNode,a=e.matchIndex,l=v.doc;if(i===c){var s=i;o=s.parentNode,e.startNodeIndex>0&&(n=l.createTextNode(s.data.substring(0,e.startNodeIndex)),o.insertBefore(n,s));var d=t(e.match,a);return o.insertBefore(d,s),e.endNodeIndex<s.length&&(r=l.createTextNode(s.data.substring(e.endNodeIndex)),o.insertBefore(r,s)),s.parentNode.removeChild(s),d}n=l.createTextNode(i.data.substring(0,e.startNodeIndex)),r=l.createTextNode(c.data.substring(e.endNodeIndex));for(var u=t(i.data.substring(e.startNodeIndex),a),f=[],h=0,p=e.innerNodes.length;p>h;++h){var g=e.innerNodes[h],m=t(g.data,a);g.parentNode.replaceChild(m,g),f.push(m)}var x=t(c.data.substring(0,e.endNodeIndex),a);return(o=i.parentNode).insertBefore(n,i),o.insertBefore(u,i),o.removeChild(i),(o=c.parentNode).insertBefore(x,c),o.insertBefore(r,c),o.removeChild(c),x}}(t)),this}function s(e){var t,n=i(e?c(e):null);for(t=n.length;t--;)o(n[t]);return this}function d(e){var n=i(c(e)),r=t.dom.createRng();return r.setStartBefore(n[0]),r.setEndAfter(n[n.length-1]),r}var u,f,h,p,g,m=[],v=t.dom;return h=t.schema.getBlockElements(),p=t.schema.getWhiteSpaceElements(),g=t.schema.getShortEndedElements(),f=r(e),{text:f,matches:m,each:a,filter:function(e){var t=[];return a(function(n,r){e(n,r)&&t.push(n)}),m=t,this},reset:function(){return m.splice(0,m.length),s(),this},matchFromElement:function(e){return m[e.getAttribute("data-mce-index")]},elementFromMatch:function(e){return i(c(e))[0]},find:function(e,t){if(f&&e.global)for(;u=e.exec(f);)m.push(n(u,t));return this},add:function(e,t,n){return m.push({start:e,end:e+t,text:f.substr(e,t),data:n}),this},wrap:l,unwrap:s,replace:function(e,n){var r=d(e);return r.deleteContents(),n.length>0&&r.insertNode(t.dom.doc.createTextNode(n)),r},rangeFromMatch:d,indexOf:c}}}),r("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(e,t,n,r,o,i,c,a){t.add("spellchecker",function(t,l){function s(){return M.textMatcher||(M.textMatcher=new e(t.getBody(),t)),M.textMatcher}function d(e,i){var c=[],a=y[e];n.each(a,function(e){c.push({text:e,onclick:function(){t.insertContent(t.dom.encode(e)),t.dom.remove(i),g()}})}),c.push({text:"-"}),T&&c.push({text:"Add to Dictionary",onclick:function(){!function(e,n){t.setProgressState(!0),h("addToDictionary",e,function(){t.setProgressState(!1),t.dom.remove(n,!0),g()},function(e){t.windowManager.alert(e),t.setProgressState(!1)})}(e,i)}}),c.push.apply(c,[{text:"Ignore",onclick:function(){m(e,i)}},{text:"Ignore all",onclick:function(){m(e,i,!0)}}]),(b=new r({items:c,context:"contextmenu",onautohide:function(e){-1!=e.target.className.indexOf("spellchecker")&&e.preventDefault()},onhide:function(){b.remove(),b=null}})).renderTo(document.body);var l=o.DOM.getPos(t.getContentAreaContainer()),s=t.dom.getPos(i[0]),d=t.dom.getRoot();"BODY"==d.nodeName?(s.x-=d.ownerDocument.documentElement.scrollLeft||d.scrollLeft,s.y-=d.ownerDocument.documentElement.scrollTop||d.scrollTop):(s.x-=d.scrollLeft,s.y-=d.scrollTop),l.x+=s.x,l.y+=s.y,b.moveTo(l.x,l.y+i[0].offsetHeight)}function u(){return t.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„    ]+',"g")}function f(e,t,r,o){var s={method:e},d="";"spellcheck"==e&&(s.text=t,s.lang=C.spellchecker_language),"addToDictionary"==e&&(s.word=t),n.each(s,function(e,t){d&&(d+="&"),d+=t+"="+encodeURIComponent(e)}),i.send({url:new c(l).toAbsolute(C.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:d,success:function(e){(e=a.parse(e))?e.error?o(e.error):r(e):o("Sever response wasn't proper JSON.")},error:function(e,t){o("Spellchecker request error: "+t.status)}})}function h(e,t,n,r){(C.spellchecker_callback||f).call(M,e,t,n,r)}function p(){v(),S||(t.setProgressState(!0),h("spellcheck",s().text,k,function(e){t.windowManager.alert(e),t.setProgressState(!1),v()}),t.focus())}function g(){t.dom.select("span.mce-spellchecker-word").length||v()}function m(e,r,o){t.selection.collapse(),o?n.each(t.dom.select("span.mce-spellchecker-word"),function(n){n.getAttribute("data-mce-word")==e&&t.dom.remove(n,!0)}):t.dom.remove(r,!0),g()}function v(){s().reset(),M.textMatcher=null,S&&(S=!1,t.fire("SpellcheckEnd"))}function x(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function N(e){var r,o=[];if((r=n.toArray(t.getBody().getElementsByTagName("span"))).length)for(var i=0;i<r.length;i++){var c=x(r[i]);null!==c&&c.length&&c===e.toString()&&o.push(r[i])}return o}function k(e){var n;return e.words?(T=!!e.dictionary,n=e.words):n=e,t.setProgressState(!1),function(e){for(var t in e)return!1;return!0}(n)?(t.windowManager.alert("No misspellings found"),void(S=!1)):(y=n,s().find(u()).filter(function(e){return!!n[e.text]}).wrap(function(e){return t.dom.create("span",{class:"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":e.text})}),S=!0,void t.fire("SpellcheckStart"))}var w,y,S,b,T,M=this,C=t.settings,B=C.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";w=function(e,t){var r=[];return n.each(t,function(e){r.push({selectable:!0,text:e.name,data:e.value})}),r}(0,n.map(B.split(","),function(e){return e=e.split("="),{name:e[0],value:e[1]}})),t.on("click",function(e){var n=e.target;if("mce-spellchecker-word"==n.className){e.preventDefault();var r=N(x(n));if(r.length>0){var o=t.dom.createRng();o.setStartBefore(r[0]),o.setEndAfter(r[r.length-1]),t.selection.setRng(o),d(n.getAttribute("data-mce-word"),r)}}}),t.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:p,selectable:!0,onPostRender:function(){var e=this;e.active(S),t.on("SpellcheckStart SpellcheckEnd",function(){e.active(S)})}});var E={tooltip:"Spellcheck",onclick:p,onPostRender:function(){var e=this;t.on("SpellcheckStart SpellcheckEnd",function(){e.active(S)})}};w.length>1&&(E.type="splitbutton",E.menu=w,E.onshow=function(e){var t=C.spellchecker_language;e.control.items().each(function(e){e.active(e.settings.data===t)})},E.onselect=function(e){C.spellchecker_language=e.control.settings.data}),t.addButton("spellchecker",E),t.addCommand("mceSpellCheck",p),t.on("remove",function(){b&&(b.remove(),b=null)}),t.on("change",g),this.getTextMatcher=s,this.getWordCharPattern=u,this.markErrors=k,this.getLanguage=function(){return C.spellchecker_language},C.spellchecker_language=C.spellchecker_language||C.language||"en"})}),function(n){var r,o,c,a,l;for(r=0;r<n.length;r++){o=e,a=(c=n[r]).split(/[.\/]/);for(var s=0;s<a.length-1;++s)o[a[s]]===t&&(o[a[s]]={}),o=o[a[s]];o[a[a.length-1]]=i[c]}if(e.AMDLC_TESTS){l=e.privateModules||{};for(c in i)l[c]=i[c];for(r=0;r<n.length;r++)delete l[n[r]];e.privateModules=l}}(["tinymce/spellcheckerplugin/DomTextMatcher"])}(this);