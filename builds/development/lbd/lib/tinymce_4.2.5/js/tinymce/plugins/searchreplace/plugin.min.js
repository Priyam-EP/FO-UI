!function(){tinymce.PluginManager.add("searchreplace",function(e){function t(){function t(){d.statusbar.find("#next").disabled(!i(s+1).length),d.statusbar.find("#prev").disabled(!i(s-1).length)}function n(){tinymce.ui.MessageBox.alert("Could not find the specified string.",function(){d.find("#find")[0].focus()})}var a,r={};a=tinymce.trim(e.selection.getContent({format:"text"}));var d=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){e.focus(),c.done()},onSubmit:function(e){var a,o,l,f;return e.preventDefault(),o=d.find("#case").checked(),f=d.find("#words").checked(),(l=d.find("#find").value()).length?r.text==l&&r.caseState==o&&r.wholeWord==f?0===i(s+1).length?void n():(c.next(),void t()):((a=c.find(l,o,f))||n(),d.statusbar.items().slice(1).disabled(0===a),t(),void(r={text:l,caseState:o,wholeWord:f})):(c.done(!1),void d.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){d.submit()}},{text:"Replace",disabled:!0,onclick:function(){c.replace(d.find("#replace").value())||(d.statusbar.items().slice(1).disabled(!0),s=-1,r={})}},{text:"Replace all",disabled:!0,onclick:function(){c.replace(d.find("#replace").value(),!0,!0),d.statusbar.items().slice(1).disabled(!0),r={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){c.prev(),t()}},{text:"Next",name:"next",disabled:!0,onclick:function(){c.next(),t()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:a},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow()}function n(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function a(t){var n,a;return a=e.dom.create("span",{"data-mce-bogus":1}),a.className="mce-match-marker",n=e.getBody(),c.done(!1),function(e,t,n,a,r){function i(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var a=e[t];if(!a)throw"Invalid capture group";n+=e[0].indexOf(a),e[0]=a}return[n,n+e[0].length,[e[0]]]}function d(e){var t;if(3===e.nodeType)return e.data;if(f[e.nodeName]&&!s[e.nodeName])return"";if(t="",(s[e.nodeName]||u[e.nodeName])&&(t+="\n"),e=e.firstChild)do{t+=d(e)}while(e=e.nextSibling);return t}var o,l,c,s,f,u,m=[],h=0;if(c=t.ownerDocument,s=r.getBlockElements(),f=r.getWhiteSpaceElements(),u=r.getShortEndedElements(),l=d(t)){if(e.global)for(;o=e.exec(l);)m.push(i(o,a));else o=l.match(e),m.push(i(o,a));return m.length&&(h=m.length,function(e,t,n){var a,r,i,d,o=[],l=0,c=e,m=t.shift(),h=0;e:for(;;){if((s[c.nodeName]||u[c.nodeName])&&l++,3===c.nodeType&&(!r&&c.length+l>=m[1]?(r=c,d=m[1]-l):a&&o.push(c),!a&&c.length+l>m[0]&&(a=c,i=m[0]-l),l+=c.length),a&&r){if(c=n({startNode:a,startNodeIndex:i,endNode:r,endNodeIndex:d,innerNodes:o,match:m[2],matchIndex:h}),l-=r.length-d,a=null,r=null,o=[],m=t.shift(),h++,!m)break}else{if((!f[c.nodeName]||s[c.nodeName])&&c.firstChild){c=c.firstChild;continue}if(c.nextSibling){c=c.nextSibling;continue}}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c.parentNode===e)break e;c=c.parentNode}}}(t,m,function(e){var t;if("function"!=typeof e){var n=e.nodeType?e:c.createElement(e);t=function(e,t){var a=n.cloneNode(!1);return a.setAttribute("data-mce-index",t),e&&a.appendChild(c.createTextNode(e)),a}}else t=e;return function(e){var n,a,r,i=e.startNode,d=e.endNode,o=e.matchIndex;if(i===d){var l=i;r=l.parentNode,e.startNodeIndex>0&&(n=c.createTextNode(l.data.substring(0,e.startNodeIndex)),r.insertBefore(n,l));var s=t(e.match[0],o);return r.insertBefore(s,l),e.endNodeIndex<l.length&&(a=c.createTextNode(l.data.substring(e.endNodeIndex)),r.insertBefore(a,l)),l.parentNode.removeChild(l),s}n=c.createTextNode(i.data.substring(0,e.startNodeIndex)),a=c.createTextNode(d.data.substring(e.endNodeIndex));for(var f=t(i.data.substring(e.startNodeIndex),o),u=[],m=0,h=e.innerNodes.length;h>m;++m){var p=e.innerNodes[m],g=t(p.data,o);p.parentNode.replaceChild(g,p),u.push(g)}var v=t(d.data.substring(0,e.endNodeIndex),o);return(r=i.parentNode).insertBefore(n,i),r.insertBefore(f,i),r.removeChild(i),(r=d.parentNode).insertBefore(v,d),r.insertBefore(a,d),r.removeChild(d),v}}(n))),h}}(t,n,a,!1,e.schema)}function r(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function i(t){var a,r=[];if((a=tinymce.toArray(e.getBody().getElementsByTagName("span"))).length)for(var i=0;i<a.length;i++){var d=n(a[i]);null!==d&&d.length&&d===t.toString()&&r.push(a[i])}return r}function d(t){var n=s,a=e.dom;(t=!1!==t)?n++:n--,a.removeClass(i(s),"mce-match-marker-selected");var r=i(n);return r.length?(a.addClass(i(n),"mce-match-marker-selected"),e.selection.scrollIntoView(r[0]),n):-1}function o(t){var n=e.dom,a=t.parentNode;n.remove(t),n.isEmpty(a)&&n.remove(a)}function l(e){var t=n(e);return null!==t&&t.length>0}var c=this,s=-1;c.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:t,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:t}),e.addCommand("SearchReplace",t),e.shortcuts.add("Meta+F","",t)},c.find=function(e,t,n){e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=n?"\\b"+e+"\\b":e;var r=a(new RegExp(e,t?"g":"gi"));return r&&(s=-1,s=d(!0)),r},c.next=function(){var e=d(!0);-1!==e&&(s=e)},c.prev=function(){var e=d(!1);-1!==e&&(s=e)},c.replace=function(t,a,d){var f,u,m,h,p,g,v=s;for(a=!1!==a,m=e.getBody(),u=tinymce.grep(tinymce.toArray(m.getElementsByTagName("span")),l),f=0;f<u.length;f++){var x=n(u[f]);if(h=p=parseInt(x,10),d||h===s){for(t.length?(u[f].firstChild.nodeValue=t,r(u[f])):o(u[f]);u[++f];){if((h=parseInt(n(u[f]),10))!==p){f--;break}o(u[f])}a&&v--}else p>s&&u[f].setAttribute("data-mce-index",p-1)}return e.undoManager.add(),s=v,a?(g=i(v+1).length>0,c.next()):(g=i(v-1).length>0,c.prev()),!d&&g},c.done=function(t){var a,i,d,o;for(i=tinymce.toArray(e.getBody().getElementsByTagName("span")),a=0;a<i.length;a++){var l=n(i[a]);null!==l&&l.length&&(l===s.toString()&&(d||(d=i[a].firstChild),o=i[a].firstChild),r(i[a]))}if(d&&o){var c=e.dom.createRng();return c.setStart(d,0),c.setEnd(o,o.data.length),!1!==t&&e.selection.setRng(c),c}}})}();